# Flutter Monolith

![Flutter Monolith](./docs/res/monolith_logo.png)

Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ãƒ¢ãƒãƒªã‚¹æ§‹é€ ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹çµ±åˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã§ã‚ã‚‹ã€‚
å¤§è¦æ¨¡ãªFlutterã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã«ãŠã„ã¦ã€è¤‡æ•°ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åŠ¹ç‡çš„ã«ç®¡ç†ã—ã€
é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰ã‹ã‚‰æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹ã¾ã§ã®å…¨ãƒ—ãƒ­ã‚»ã‚¹ã‚’è‡ªå‹•åŒ–ã™ã‚‹ã€‚

## ğŸš€ è§£æ±ºã™ã‚‹èª²é¡Œ

å¤§è¦æ¨¡ãªFlutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªèª²é¡ŒãŒç™ºç”Ÿã™ã‚‹ï¼š

**ç’°å¢ƒç®¡ç†ã®è¤‡é›‘åŒ–**
- ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼åˆ¥ã®è¨­å®šç®¡ç†ãŒç…©é›‘
- æ©Ÿå¯†ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†å•é¡Œ
- é–‹ç™ºè€…é–“ã§ã®ç’°å¢ƒæ§‹ç¯‰ã®ä¸æ•´åˆ

**ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºã®é™ç•Œ**
- Flutteræ¨™æº–ã®å›½éš›åŒ–æ©Ÿèƒ½ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã®ã¿
- ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å˜ä½ã§ã®ç‹¬ç«‹ã—ãŸãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºãŒå›°é›£
- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã¨ç¿»è¨³ãƒªã‚½ãƒ¼ã‚¹ã®åˆ†é›¢ãŒã§ããªã„

**iOSé–‹ç™ºã®è¤‡é›‘ã•**
- Xcodeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šã®æ‰‹å‹•ç®¡ç†
- è¨¼æ˜æ›¸ãƒ»ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®é…å¸ƒ
- ãƒãƒ¼ãƒ é–“ã§ã®è¨­å®šå…±æœ‰ã®å›°é›£

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã®éåŠ¹ç‡**
- å„ãƒ„ãƒ¼ãƒ«ã‚’å€‹åˆ¥å®Ÿè¡Œã™ã‚‹æ‰‹é–“
- CI/CDç’°å¢ƒã§ã®è¨­å®šã®è¤‡é›‘åŒ–
- é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ¨™æº–åŒ–ä¸è¶³

## âœ¨ ä¸»è¦æ©Ÿèƒ½

### ğŸ”§ çµ±åˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†
- **monolith.yaml**: å…¨è¨­å®šã‚’ä¸€å…ƒç®¡ç†
- **çµ±ä¸€ãƒ©ãƒ³ãƒŠãƒ¼**: `dart run monolith:*`ã‚³ãƒãƒ³ãƒ‰ã§å…¨æ©Ÿèƒ½å®Ÿè¡Œ
- **CI/CDæœ€é©åŒ–**: è‡ªå‹•åŒ–ã•ã‚ŒãŸé–‹ç™ºç’°å¢ƒæ§‹ç¯‰

### ğŸŒ é«˜åº¦ãªãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚º
- **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½ç®¡ç†**: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã”ã¨ã®ç‹¬ç«‹ã—ãŸãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºãƒªã‚½ãƒ¼ã‚¹
- **CSVç®¡ç†**: ã‚·ãƒ³ãƒ—ãƒ«ãªå½¢å¼ã§ã®å¤šè¨€èªãƒªã‚½ãƒ¼ã‚¹å®šç¾©
- **å‹å®‰å…¨ã‚¢ã‚¯ã‚»ã‚¹**: è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹Mixinã‚¯ãƒ©ã‚¹ã«ã‚ˆã‚‹å®Ÿè¡Œæ™‚ä¿è¨¼

### ğŸ” ã‚»ã‚­ãƒ¥ã‚¢ãªè¨­å®šç®¡ç†
- **ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆåˆ†é›¢**: æ©Ÿå¯†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‹ã‚‰é™¤å¤–
- **1Passwordé€£æº**: `op inject`ã‚³ãƒãƒ³ãƒ‰ã¨ã®çµ±åˆ
- **è‡ªå‹•å±•é–‹**: Base64ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å®‰å…¨ãªé…å¸ƒ

### ğŸ“± iOSé–‹ç™ºè‡ªå‹•åŒ–
- **xcodegençµ±åˆ**: YAMLãƒ™ãƒ¼ã‚¹ã®Xcodeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ
- **ç’°å¢ƒå¤‰æ•°æ³¨å…¥**: ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ«ã¨ã®é€£æº
- **ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ**: ãƒ“ãƒ«ãƒ‰ã«å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã®äº‹å‰ä½œæˆ

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```yaml
# pubspec.yaml
dev_dependencies:
  monolith_runner: ^1.0.0
```

### åŸºæœ¬è¨­å®š

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«`monolith.yaml`ã‚’ä½œæˆï¼š

```yaml
# monolith.yaml
includes:
  - secrets/monolith.yaml

define:
  output_path: secrets/dart-define/
  generate:
    package_name: foundation_metadata
    helper_path: lib/gen/defines.dart
  flavors:
    development:
      FLAVOR: development
      API_URL: https://api-dev.example.com
    production:
      FLAVOR: production
      API_URL: https://api.example.com

localization:
  languages:
    - ja
    - en
  app:
    package_name: app
    arb_path: lib/l10n/
  package:
    path_prefixes:
      - packages/
    resources_path: res/

xcodegen:
  package_name: app
  touch_files:
    - ios/GoogleService-Info.plist

install:
  - path: secrets/android.keystore
    base64_file: op://vault-id/android-keystore/keystore.base64
  - path: app/ios/GoogleService-Info.plist
    base64_file: op://vault-id/google-services/ios-production.plist.base64
```

### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

```bash
# ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã®æ³¨å…¥
op inject --force --in-file monolith.yaml --out-file secrets/monolith.yaml

# é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
dart run monolith:install        # ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å±•é–‹
dart run monolith:define         # ç’°å¢ƒå®šæ•°ã®ç”Ÿæˆ
dart run monolith:localization   # ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºãƒªã‚½ãƒ¼ã‚¹ã®ç”Ÿæˆ
dart run monolith:xcodegen       # Xcodeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆ

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ“ãƒ«ãƒ‰
flutter build ios --dart-define-from-file=secrets/dart-define/production.json
```

## ğŸ“¦ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹æˆ

### Core Packages

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | èª¬æ˜ | ç”¨é€” |
|-----------|------|------|
| **monolith** | ãƒ¡ã‚¤ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ»ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã®çµ±åˆ¶ |
| **monolith_runner** | çµ±ä¸€ãƒ©ãƒ³ãƒŠãƒ¼ | `dart run monolith:*`ã‚³ãƒãƒ³ãƒ‰ã®æä¾› |

### Feature Packages

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | èª¬æ˜ | ä¸»è¦æ©Ÿèƒ½ |
|-----------|------|----------|
| **monolith_define** | Dart Defineç®¡ç† | ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼åˆ¥ç’°å¢ƒå®šæ•°ãƒ»JSONãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ |
| **monolith_install** | ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«å±•é–‹ | æ©Ÿå¯†ãƒ•ã‚¡ã‚¤ãƒ«ã®å®‰å…¨ãªé…å¸ƒãƒ»å±•é–‹ |
| **monolith_localization** | ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚º | ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç‹¬ç«‹å‹å¤šè¨€èªãƒªã‚½ãƒ¼ã‚¹ç®¡ç† |
| **monolith_localization_runtime** | ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºãƒ©ãƒ³ã‚¿ã‚¤ãƒ  | ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œæ™‚ã‚µãƒãƒ¼ãƒˆ |
| **monolith_xcodegen** | Xcodeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ | xcodegenãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ãŸXcodeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è‡ªå‹•ç”Ÿæˆ |

## ğŸ—ï¸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ä¾‹

```
my_flutter_app/
â”œâ”€â”€ monolith.yaml                    # çµ±åˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ secrets/
â”‚   â”œâ”€â”€ monolith.yaml               # ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæ³¨å…¥å¾Œã®è¨­å®š
â”‚   â””â”€â”€ dart-define/                # ç”Ÿæˆã•ã‚ŒãŸç’°å¢ƒå®šæ•°
â”‚       â”œâ”€â”€ development.json
â”‚       â””â”€â”€ production.json
â”œâ”€â”€ app/                            # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ l10n/                   # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚º
â”‚   â”‚   â””â”€â”€ gen/
â”‚   â”‚       â””â”€â”€ defines.dart        # ç”Ÿæˆã•ã‚ŒãŸç’°å¢ƒå®šæ•°ã‚¯ãƒ©ã‚¹
â”‚   â””â”€â”€ ios/
â”‚       â””â”€â”€ Runner.xcodeproj        # ç”Ÿæˆã•ã‚ŒãŸXcodeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
â””â”€â”€ packages/                       # ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»æ©Ÿèƒ½åˆ¥ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
    â”œâ”€â”€ domain/
    â”‚   â””â”€â”€ user/
    â”‚       â”œâ”€â”€ res/
    â”‚       â”‚   â””â”€â”€ strings.csv     # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç‹¬è‡ªã®ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚º
    â”‚       â””â”€â”€ lib/
    â”‚           â””â”€â”€ gen/
    â”‚               â””â”€â”€ strings.dart # ç”Ÿæˆã•ã‚ŒãŸãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºã‚¯ãƒ©ã‚¹
    â””â”€â”€ screen/
        â””â”€â”€ login/
            â”œâ”€â”€ res/
            â”‚   â””â”€â”€ strings.csv
            â””â”€â”€ lib/
                â””â”€â”€ gen/
                    â””â”€â”€ strings.dart
```

## ğŸ”„ é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### 1. åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```bash
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
dart pub get

# é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰
op inject --force --in-file monolith.yaml --out-file secrets/monolith.yaml
dart run monolith:install
dart run monolith:define
dart run monolith:localization
dart run monolith:xcodegen
```

### 2. æ—¥å¸¸é–‹ç™º
```bash
# ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºãƒªã‚½ãƒ¼ã‚¹ã®æ›´æ–°
dart run monolith:localization

# æ–°ã—ã„ç’°å¢ƒå®šæ•°ã®è¿½åŠ 
dart run monolith:define

# iOSè¨­å®šã®æ›´æ–°
dart run monolith:xcodegen
```

### 3. CI/CDçµ±åˆ
```yaml
# .github/workflows/build.yml
- name: Setup development environment
  env:
    OP_SERVICE_ACCOUNT_TOKEN: ${{ secrets.OP_SERVICE_ACCOUNT_TOKEN }}
  run: |
    op inject --force --in-file monolith.yaml --out-file secrets/monolith.yaml
    dart run monolith:install
    dart run monolith:define
    dart run monolith:xcodegen

- name: Build iOS
  run: flutter build ios --dart-define-from-file=secrets/dart-define/production.json
```

## ğŸ¤ å¯¾è±¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

ã“ã®ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã¯ä»¥ä¸‹ã®ã‚ˆã†ãªFlutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æœ€é©ã§ã‚ã‚‹ï¼š

- **å¤§è¦æ¨¡ãªãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ãƒ¢ãƒãƒªã‚¹æ§‹é€ **ã‚’æ¡ç”¨ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- **è¤‡æ•°ã®é–‹ç™ºè€…ãƒ»ãƒãƒ¼ãƒ **ãŒå”æ¥­ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- **ãƒãƒ«ãƒãƒ•ãƒ¬ãƒ¼ãƒãƒ¼**ï¼ˆé–‹ç™ºãƒ»æœ¬ç•ªç’°å¢ƒãªã©ï¼‰ã‚’æŒã¤ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- **å¤šè¨€èªå¯¾å¿œ**ãŒå¿…è¦ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- **iOS/Androidä¸¡å¯¾å¿œ**ã®ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- **CI/CD**ã«ã‚ˆã‚‹è‡ªå‹•åŒ–ã‚’é‡è¦–ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License - è©³ç´°ã¯[LICENSE](LICENSE)ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

Issueå ±å‘Šã‚„ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ­“è¿ã™ã‚‹ã€‚å¤§è¦æ¨¡ãªå¤‰æ›´ã‚’è¡Œã†å‰ã«ã€
ã¾ãšIssueã§è­°è«–ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ã€‚

---

**Flutter Monolith**ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€å¤§è¦æ¨¡Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¤‡é›‘æ€§ã‚’ç®¡ç†ã—ã€
é–‹ç™ºåŠ¹ç‡ã‚’å¤§å¹…ã«å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ãƒ¢ãƒãƒªã‚¹æ§‹é€ ã®åˆ©ç‚¹ã‚’æœ€å¤§é™æ´»ç”¨ã—ã€
ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã§ä¿å®ˆæ€§ã®é«˜ã„Flutterã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã—ã‚ˆã†ã€‚ 